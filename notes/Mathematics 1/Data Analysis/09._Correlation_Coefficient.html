<!DOCTYPE html>
<!-- tags: Data Analysis -->
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   Correlation Coefficient (相関係数)
  </title>
  <script>
   MathJax = {
            tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
            svg: {fontCache: 'global'}
        };
  </script>
  <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
  <link href="/static/notes_style.css" rel="stylesheet"/>
  <style>
   .interactive-demo {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border: 2px solid #3498db;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
   }
   .demo-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
    margin-bottom: 20px;
   }
   .control-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
   }
   .control-group label {
    font-weight: bold;
    color: #2c3e50;
   }
   .control-group input, .control-group textarea {
    padding: 8px;
    border: 1px solid #bdc3c7;
    border-radius: 5px;
    font-size: 14px;
   }
   .control-group textarea {
    min-height: 60px;
    resize: vertical;
   }
   .demo-output {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    border: 1px solid #ecf0f1;
   }
   .formula-block {
    background: #ecf0f1;
    border-left: 4px solid #3498db;
    padding: 15px;
    margin: 15px 0;
    font-family: 'Times New Roman', serif;
   }
   .practice-problem {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
   }
   .solution {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
    display: none;
   }
   .solution-button {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
   }
   .solution-button:hover {
    background: #0056b3;
   }
   .key-takeaways {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
   }
   .key-takeaways h3 {
    margin-top: 0;
    color: white;
   }
   .key-takeaways ul {
    margin: 10px 0 0 0;
    padding-left: 20px;
   }
   .key-takeaways li {
    margin: 8px 0;
   }
   .worked-example {
    background: #e8f4f8;
    border: 1px solid #bee5eb;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
   }
   .worked-example h4 {
    margin-top: 0;
    color: #0c5460;
   }
   .math-foundation {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
   }
   .math-foundation h3 {
    margin-top: 0;
    color: #2c3e50;
   }
   .correlation-scale {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
   }
   .correlation-range {
    background: white;
    border: 1px solid #ecf0f1;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
   }
   .correlation-range h4 {
    margin-top: 0;
    color: #2c3e50;
   }
   .correlation-range .range {
    font-size: 1.2em;
    font-weight: bold;
    margin: 10px 0;
   }
   .correlation-range .description {
    font-size: 14px;
    color: #666;
   }
   .calculation-steps {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
   }
   .step {
    margin: 15px 0;
    padding: 10px;
    background: white;
    border-radius: 5px;
    border-left: 3px solid #3498db;
   }
   .step-number {
    font-weight: bold;
    color: #3498db;
    margin-right: 10px;
   }
   .properties-list {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
   }
   .properties-list h4 {
    margin-top: 0;
    color: #856404;
   }
   .properties-list ul {
    margin: 10px 0 0 0;
    padding-left: 20px;
   }
   .correlation-analysis {
    background: white;
    border: 1px solid #ecf0f1;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
   }
   .correlation-result {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 15px 0;
    flex-wrap: wrap;
   }
   .correlation-stat {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    min-width: 120px;
   }
   .correlation-stat .value {
    font-size: 1.5em;
    font-weight: bold;
    color: #3498db;
   }
   .correlation-stat .label {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
   }
   .derivation-section {
    background: #e8f4f8;
    border: 1px solid #bee5eb;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
   }
   .derivation-section h4 {
    margin-top: 0;
    color: #0c5460;
   }
   @media (max-width: 768px) {
    .demo-controls {
     flex-direction: column;
     align-items: stretch;
    }
    .control-group {
     width: 100%;
    }
    .correlation-scale {
     grid-template-columns: 1fr;
    }
    .correlation-result {
     flex-direction: column;
     align-items: center;
    }
   }
  </style>
 </head>
 <body>
  <div class="fancy-title" data-topic="Data Analysis">
   Correlation Coefficient (相関係数)
  </div>
  <div class="container">
   <div class="main-content">

    <div class="math-foundation">
     <h3>Mathematical Foundation</h3>
     <p>The correlation coefficient measures the strength and direction of the linear relationship between two variables. It is a standardized measure that ranges from -1 to +1, where:</p>
     <ul>
      <li><strong>+1</strong> indicates a perfect positive linear relationship</li>
      <li><strong>0</strong> indicates no linear relationship</li>
      <li><strong>-1</strong> indicates a perfect negative linear relationship</li>
     </ul>

     <div class="formula-block">
      <strong>Correlation Coefficient (r):</strong>
      <div style="font-size: 1.2em; margin: 10px 0;">
       \( r = \dfrac{s_{xy}}{s_x s_y} = \dfrac{\sum (x_i - \overline{x})(y_i - \overline{y})}{\sqrt{\sum (x_i - \overline{x})^2 \sum (y_i - \overline{y})^2}} \)
      </div>
      <p>Where:</p>
      <ul>
       <li>\( s_{xy} \) = covariance between x and y</li>
       <li>\( s_x \) = standard deviation of x</li>
       <li>\( s_y \) = standard deviation of y</li>
      </ul>
     </div>
    </div>

    <div class="correlation-scale">
     <div class="correlation-range">
      <h4>Perfect Positive</h4>
      <div class="range">r = +1.0</div>
      <div class="description">All points lie exactly on upward-sloping line</div>
     </div>
     <div class="correlation-range">
      <h4>Strong Positive</h4>
      <div class="range">r = 0.7 to 0.9</div>
      <div class="description">Points cluster tightly around upward trend</div>
     </div>
     <div class="correlation-range">
      <h4>Moderate Positive</h4>
      <div class="range">r = 0.3 to 0.7</div>
      <div class="description">Upward trend with some scatter</div>
     </div>
     <div class="correlation-range">
      <h4>Weak/No Correlation</h4>
      <div class="range">r = -0.3 to 0.3</div>
      <div class="description">Little to no linear relationship</div>
     </div>
     <div class="correlation-range">
      <h4>Moderate Negative</h4>
      <div class="range">r = -0.7 to -0.3</div>
      <div class="description">Downward trend with some scatter</div>
     </div>
     <div class="correlation-range">
      <h4>Strong Negative</h4>
      <div class="range">r = -0.9 to -0.7</div>
      <div class="description">Points cluster tightly around downward trend</div>
     </div>
     <div class="correlation-range">
      <h4>Perfect Negative</h4>
      <div class="range">r = -1.0</div>
      <div class="description">All points lie exactly on downward-sloping line</div>
     </div>
    </div>

    <div class="derivation-section">
     <h4>Derivation from Covariance</h4>
     <p>The correlation coefficient is derived from the covariance by standardizing it. This standardization:</p>
     <ul>
      <li>Removes the units of measurement</li>
      <li>Allows comparison between different datasets</li>
      <li>Provides a scale from -1 to +1</li>
     </ul>
     <div style="font-size: 1.1em; margin: 15px 0;">
      \( r = \dfrac{\text{covariance}}{\text{standard deviation of x} \times \text{standard deviation of y}} = \dfrac{s_{xy}}{s_x s_y} \)
     </div>
    </div>

    <div class="properties-list">
     <h4>Properties of Correlation Coefficient</h4>
     <ul>
      <li><strong>Range:</strong> Always between -1 and +1</li>
      <li><strong>Unit-free:</strong> No units of measurement</li>
      <li><strong>Symmetric:</strong> r(x,y) = r(y,x)</li>
      <li><strong>Scale invariant:</strong> Unaffected by linear transformations</li>
      <li><strong>Sign:</strong> Positive for positive correlation, negative for negative correlation</li>
      <li><strong>Magnitude:</strong> Closer to 1 (or -1) indicates stronger relationship</li>
     </ul>
    </div>

    <div class="interactive-demo">
     <h3>Interactive Correlation Coefficient Calculator</h3>
     <div class="demo-controls">
      <div class="control-group">
       <label for="x-data">X Values (comma-separated):</label>
       <input id="x-data" placeholder="e.g., 1, 2, 3, 4, 5" value="1, 2, 3, 4, 5">
      </div>
      <div class="control-group">
       <label for="y-data">Y Values (comma-separated):</label>
       <input id="y-data" placeholder="e.g., 2, 4, 6, 8, 10" value="2, 4, 6, 8, 10">
      </div>
      <button onclick="calculateCorrelation()" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; align-self: flex-end;">Calculate r</button>
     </div>

     <div class="demo-output" id="demo-output">
      <strong>Current Data:</strong><br>
      X: [1, 2, 3, 4, 5]<br>
      Y: [2, 4, 6, 8, 10]<br>
      <div class="correlation-result">
       <div class="correlation-stat">
        <div class="value">1.000</div>
        <div class="label">Correlation (r)</div>
       </div>
       <div class="correlation-stat">
        <div class="value">Perfect</div>
        <div class="label">Strength</div>
       </div>
       <div class="correlation-stat">
        <div class="value">Positive</div>
        <div class="label">Direction</div>
       </div>
      </div>
     </div>
    </div>

    <div class="calculation-steps">
     <h4>Step-by-Step Calculation</h4>
     <div class="step">
      <span class="step-number">1.</span> Calculate means: \( \overline{x} = \dfrac{\sum x_i}{n} \), \( \overline{y} = \dfrac{\sum y_i}{n} \)
     </div>
     <div class="step">
      <span class="step-number">2.</span> Calculate deviations: \( x_i - \overline{x} \), \( y_i - \overline{y} \)
     </div>
     <div class="step">
      <span class="step-number">3.</span> Calculate products: \( (x_i - \overline{x})(y_i - \overline{y}) \)
     </div>
     <div class="step">
      <span class="step-number">4.</span> Calculate squared deviations: \( (x_i - \overline{x})^2 \), \( (y_i - \overline{y})^2 \)
     </div>
     <div class="step">
      <span class="step-number">5.</span> Sum the products and squared deviations
     </div>
     <div class="step">
      <span class="step-number">6.</span> Apply formula: \( r = \dfrac{\sum (x_i - \overline{x})(y_i - \overline{y})}{\sqrt{\sum (x_i - \overline{x})^2 \sum (y_i - \overline{y})^2}} \)
     </div>
    </div>

    <div class="worked-example">
     <h4>Worked Example</h4>
     <p>Calculate r for: X = [1, 2, 3, 4, 5], Y = [2, 4, 6, 8, 10]</p>

     <div style="margin: 15px 0;">
      <strong>Step 1:</strong> Means<br>
      \( \overline{x} = \dfrac{1+2+3+4+5}{5} = 3 \)<br>
      \( \overline{y} = \dfrac{2+4+6+8+10}{5} = 6 \)
     </div>

     <div style="margin: 15px 0;">
      <strong>Step 2:</strong> Deviations and products<br>
      <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
       <tr style="background: #f8f9fa;"><th style="border: 1px solid #dee2e6; padding: 8px;">x</th><th style="border: 1px solid #dee2e6; padding: 8px;">y</th><th style="border: 1px solid #dee2e6; padding: 8px;">x-μx</th><th style="border: 1px solid #dee2e6; padding: 8px;">y-μy</th><th style="border: 1px solid #dee2e6; padding: 8px;">Product</th><th style="border: 1px solid #dee2e6; padding: 8px;">(x-μx)²</th><th style="border: 1px solid #dee2e6; padding: 8px;">(y-μy)²</th></tr>
       <tr><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">1</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">-2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">-4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">8</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">16</td></tr>
       <tr><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">-1</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">-2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">1</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td></tr>
       <tr><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">3</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">6</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">0</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">0</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">0</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">0</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">0</td></tr>
       <tr><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">8</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">1</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">1</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td></tr>
       <tr><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">5</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">10</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">2</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">8</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">4</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">16</td></tr>
       <tr style="background: #e9ecef; font-weight: bold;"><td colspan="4" style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">Sums</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">20</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">10</td><td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">40</td></tr>
      </table>
     </div>

     <div style="margin: 15px 0;">
      <strong>Step 3:</strong> Calculate correlation<br>
      \( r = \dfrac{20}{\sqrt{10 \times 40}} = \dfrac{20}{\sqrt{400}} = \dfrac{20}{20} = 1 \)
     </div>

     <p><strong>Result:</strong> Perfect positive correlation (r = 1.0)</p>
    </div>

    <h3>Practice Problems</h3>

    <div class="practice-problem">
     <strong>Problem 1:</strong> Calculate r for X = [2, 4, 6, 8], Y = [1, 2, 3, 4]
     <br><button class="solution-button" onclick="toggleSolution(1)">Show Solution</button>
     <div class="solution" id="solution1">
      <strong>Solution:</strong><br>
      Means: μx = 5, μy = 2.5<br>
      Sum of products = 2+4+6+8 = 20<br>
      Sum of x² deviations = 4+1+1+9 = 15<br>
      Sum of y² deviations = 2.25+0.25+0.25+2.25 = 5<br>
      r = 20/√(15×5) = 20/√75 = 20/(5√3) ≈ 0.943<br>
      <strong>Strong positive correlation</strong>
     </div>
    </div>

    <div class="practice-problem">
     <strong>Problem 2:</strong> What does r = -0.85 indicate?
     <br><button class="solution-button" onclick="toggleSolution(2)">Show Solution</button>
     <div class="solution" id="solution2">
      <strong>Solution:</strong><br>
      Strong negative correlation - as one variable increases, the other decreases significantly.
     </div>
    </div>

    <div class="practice-problem">
     <strong>Problem 3:</strong> Calculate r for X = [1, 2, 3, 4, 5], Y = [5, 4, 3, 2, 1]
     <br><button class="solution-button" onclick="toggleSolution(3)">Show Solution</button>
     <div class="solution" id="solution3">
      <strong>Solution:</strong><br>
      This is a perfect negative correlation. r = -1.0
     </div>
    </div>

    <div class="practice-problem">
     <strong>Problem 4:</strong> If r = 0.2, what can you conclude?
     <br><button class="solution-button" onclick="toggleSolution(4)">Show Solution</button>
     <div class="solution" id="solution4">
      <strong>Solution:</strong><br>
      Weak positive correlation - there is a slight tendency for the variables to increase together, but the relationship is not strong.
     </div>
    </div>

    <div class="practice-problem">
     <strong>Problem 5:</strong> Why is correlation coefficient preferred over covariance?
     <br><button class="solution-button" onclick="toggleSolution(5)">Show Solution</button>
     <div class="solution" id="solution5">
      <strong>Solution:</strong><br>
      Correlation coefficient is standardized (ranges from -1 to 1) and unit-free, making it easier to interpret and compare across different datasets. Covariance depends on the units of measurement.
     </div>
    </div>

    <div class="key-takeaways">
     <h3>Key Takeaways</h3>
     <ul>
      <li><strong>Formula:</strong> \( r = \dfrac{s_{xy}}{s_x s_y} \) or expanded form with deviations</li>
      <li><strong>Range:</strong> Always between -1 and +1</li>
      <li><strong>Interpretation:</strong> Magnitude indicates strength, sign indicates direction</li>
      <li><strong>Perfect Correlation:</strong> |r| = 1 means all points lie on a straight line</li>
      <li><strong>Standardization:</strong> Removes units, allows comparison between datasets</li>
      <li><strong>Symmetric:</strong> r(x,y) = r(y,x)</li>
      <li><strong>Scale Invariant:</strong> Unaffected by linear transformations of variables</li>
      <li><strong>Linear Only:</strong> Only measures linear relationships</li>
      <li><strong>Outlier Sensitive:</strong> Extreme values can significantly affect r</li>
      <li><strong>Causation ≠ Correlation:</strong> High correlation doesn't imply causation</li>
     </ul>
    </div>

    <script>
     function calculateCorrelation() {
      const xInput = document.getElementById('x-data').value;
      const yInput = document.getElementById('y-data').value;

      const xValues = xInput.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
      const yValues = yInput.split(',').map(y => parseFloat(y.trim())).filter(y => !isNaN(y));

      if (xValues.length !== yValues.length || xValues.length < 2) {
       alert('Please enter equal number of X and Y values (at least 2 pairs).');
       return;
      }

      // Calculate correlation coefficient
      const correlation = calculateCorrelationCoeff(xValues, yValues);
      const strength = Math.abs(correlation) >= 0.8 ? 'Strong' :
                      Math.abs(correlation) >= 0.6 ? 'Moderate' :
                      Math.abs(correlation) >= 0.3 ? 'Weak' : 'Very Weak';
      const direction = correlation > 0 ? 'Positive' : correlation < 0 ? 'Negative' : 'None';

      // Update output
      const output = document.getElementById('demo-output');
      output.innerHTML = `<strong>Current Data:</strong><br>
      X: [${xValues.join(', ')}]<br>
      Y: [${yValues.join(', ')}]<br>
      <div class="correlation-result">
       <div class="correlation-stat">
        <div class="value">${correlation.toFixed(3)}</div>
        <div class="label">Correlation (r)</div>
       </div>
       <div class="correlation-stat">
        <div class="value">${strength}</div>
        <div class="label">Strength</div>
       </div>
       <div class="correlation-stat">
        <div class="value">${direction}</div>
        <div class="label">Direction</div>
       </div>
      </div>`;

      // Re-render MathJax
      if (window.MathJax) {
       MathJax.typesetPromise([output]).catch(function(err) {
        console.log('MathJax re-render error:', err);
       });
      }
     }

     function calculateCorrelationCoeff(x, y) {
      const n = x.length;
      const sumX = x.reduce((a, b) => a + b, 0);
      const sumY = y.reduce((a, b) => a + b, 0);
      const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
      const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
      const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);

      const numerator = n * sumXY - sumX * sumY;
      const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

      return denominator === 0 ? 0 : numerator / denominator;
     }

     function toggleSolution(num) {
      const solution = document.getElementById('solution' + num);
      if (solution.style.display === 'none' || solution.style.display === '') {
       solution.style.display = 'block';
      } else {
       solution.style.display = 'none';
      }
     }

     // Initialize with default data
     calculateCorrelation();
    </script>
   </div>
  </div>
 </body>
</html>
